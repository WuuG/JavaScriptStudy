# 能力检测
获取元素的能力检测
``` js
function getElement(id) {
	if (document.getElementById) {
		return document.getElementById(id)
	} else if (document.all) { // IE没有getElementById()这个方法
		return document.all[id]
	} else {
		throw new Error("No way to retrieve element!")
	}
}
```
## 安全能力检测
错误的能力检测,因为只能检测其是否有这个属性。而无法检测其是否可排序
``` js
function isSortable(object) {
	return !!object.sort 
}
```
更好的方式是检测sort是不是函数
``` js
function isSortable(object) {
	return typeof object.sort == 'function'
}
```
## 基于能力检测进行浏览器分析
能力检测的优点在于，伪造用户代理字符串很简单，而伪造能够欺骗能力检测的浏览器特性却很难。
### 检测特性
可以按照能力将浏览器归类。如果你的应用程序需要使用特定的浏览器能力，最好集中检测能力。
``` js
// 检测浏览器是否支持Netscape式的插件
let hasNSPlugins = !!(navigator.plugins && navigator.plugins.length)
// 检测浏览器是否具有DOM Level 1 能力
let hasDOM1 = !!(document.getElementById && document.createElement && document.getElementsByTagName)
```
### 检测浏览器
可以根据对浏览器特性的检测并与已知特性对比，确认用户使用的是什么浏览器(未来的浏览器版本可能会不适用)。
### 能力检测的局限。
若是使用不够特殊，或者太多的假设，都会对能力检测造成干扰。
> 能力检测适用与决定下一步怎么做，而不一定能够作为辨识浏览器的标志。
# 用户代理检测
用户代理字符串包含在每个HTTP请求的头部，在JavaScript中可以通过navigator.userAgent访问。在服务器端根据用户代理字符串确定浏览器执行相应操作，而在客户端，则认为用户代理检测不可靠(因为复杂的userAgent字符串的历史)。
## 浏览器分析
### 伪造用户代理
只读属性，无法简单的修改
``` js
console.log(window.navigator.userAgent);
window.navigator.userAgent = '123'
console.log(window.navigator.userAgent);
```
不过，通过简单的办法可以绕过这个限制.比如有些浏览器提供__definGetter__方法，可以篡改用户代理。
``` js
console.log(window.navigator.userAgent);
window.navigator.__defineGetter__('userAgent', () => 'foobar')
console.log(window.navigator.userAgent);  // foobar
```

### 分析浏览器
可以通过用户代理字符串识别浏览器相关环境。 同时Github上也有一些第三方用户代理解析程序：
+ Bowse
+ UAOarser.js 
+ ...

> mozila维基页面也有一个页面，提供了用户代理解析程序的列表。
# 软件与硬件检测
现代浏览器提供了一组与页面执行环境相关的信息，包括浏览器、操作系统、硬件和周边设备信息。这些信息可以通过window.navigator上的一组API获得。

> 在使用这些API时首先要检测是否存在，因为大多数不是强制性的，且很多浏览器不支持。
## 识别浏览器和操作系统
navigator和screen对象页提供了关于页面所在软件环境的信息。

其中比较有意思的是orientation. 包含屏幕信息。 其中angle：屏幕角度(是否翻转) 
## 浏览器元数据
navigator对象暴露处一些API，可以提供浏览器和操作系统的状态信息。
## Geolocation API
navigator.geolocation属性暴露了GeolocationApi，可以让浏览器脚本感知当前设备的地理位置。手机